##Calling some useful libraries##
require(gstudio)
require(popgraph)

##Importing some data##
data <- read_population(path, type, locus.columns)

##Defining parameters##
nRep <- 999                                                   #Number of iterations
nTresh <- length(unique(data$Population))                     #Number of populations involved in the analysis

w <- rep(NA, length(unique(data$Population)))
Me <- rep(NA, nRep)
e <- rep(NA, nTresh)


##Loop estimating variability in topology##
for (k in 1:nTresh){
  for (j in 1:nRep){
    
    Y <- data
    
    t <- as.data.frame(unique(Y[1]))
    t[, 2] <- round(sample(length(unique(Y$Population)), replace = FALSE))
    t[, 3] <- 1:length(unique(Y$Population))
    colnames(t) <- c("Population", "RandomPop", "Order")
    Y <- merge(t, Y, by.y = "Population")
    
    n <- Y[!(Y$RandomPop <= k), ]
    
    ##Creating popgraph##
    mv <- to_mv(n)
    pops <- n$Population
    graph <- popgraph( x = mv, groups = pops)
    
    ##Estimating eigenvector centrality via igraph package
    Me[j] <- mean(igraph::evcent(graph, directed = FALSE, scale = TRUE, weight = NULL, options = igraph.arpack.default)$vector)
                     
  }
  
  e[k] <- list(Me)
  
}
